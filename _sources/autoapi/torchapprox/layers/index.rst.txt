:py:mod:`torchapprox.layers`
============================

.. py:module:: torchapprox.layers

.. autoapi-nested-parse::

   Approximate Layer implementations



Submodules
----------
.. toctree::
   :titlesonly:
   :maxdepth: 1

   approx_conv2d/index.rst
   approx_layer/index.rst
   approx_linear/index.rst


Package Contents
----------------

Classes
~~~~~~~

.. autoapisummary::

   torchapprox.layers.ApproxConv2d
   torchapprox.layers.ApproxLayer
   torchapprox.layers.InferenceMode
   torchapprox.layers.ApproxLinear




.. py:class:: ApproxConv2d(*args, **kwargs)

   Bases: :py:obj:`torch.nn.Conv2d`, :py:obj:`torchapprox.layers.approx_layer.ApproxLayer`

   Approximate 2D Convolution layer implementation

   .. py:property:: opcount
      :type: int

      Number of multiplications for a single
      forward pass of this layer

   .. py:property:: fan_in
      :type: int

      Number of incoming connection for a single neuron

   .. py:property:: conv_args
      :type: torchapprox.operators.conv2d.Conv2dArgs

      Wrap layer configuration in dataclass for more convenient passing around

   .. py:method:: from_super(cls_instance: torch.nn.Conv2d)
      :staticmethod:

      Alias for from_conv2d


   .. py:method:: from_conv2d(conv2d: torch.nn.Conv2d)
      :staticmethod:

      Construct ApproxConv2d from torch.nn.Conv2d layer


   .. py:method:: use_fast_dwconv() -> bool

      Determine whether layer can be run using DWConv CUDA kernels

      :returns:

                - True if layer can be mapped to dwconv2d backend function
                - False otherwise


   .. py:method:: output_dims(x)

      Output width and height


   .. py:method:: baseline_fwd(x)

      Unperturbed FP32 forward pass

      :param x: Layer input

      :returns: Layer output


   .. py:method:: quant_fwd(x)

      Quantized Forward Pass
      Performs the layer operation with an additional pass through the
      currently configured quantizer

      :param x: Layer input

      :returns: Layer output


   .. py:method:: approx_fwd(x)

      Approximate Product Forward Pass
      Performs the layer operation using the currently configured
      approximate product Lookup Table.
      Quantization is implicitly applied to the input and weights.

      :param x: Layer input

      :returns: Layer output


   .. py:method:: forward(x: torch.Tensor) -> torch.Tensor

      Forward pass with currently selected mode applied

      :param x: Layer input

      :returns: Layer output



.. py:class:: ApproxLayer

   Bases: :py:obj:`abc.ABC`

   Derivable Abstract Base Class for implementing Approximate Neural Network layers

   .. py:property:: stdev
      :type: float

      Perturbation Error Relative Standard Deviation

      :returns: Currently configured perturbation standard deviation

   .. py:property:: mean
      :type: float

      Perturbation Error mean

      :returns: Currently configured perturbation mean

   .. py:property:: fan_in
      :type: int
      :abstractmethod:

      Number of incoming connections for a neuron in this layer

   .. py:property:: opcount
      :type: int
      :abstractmethod:

      Number of multiplications for a single
      forward pass of this layer

   .. py:method:: from_super(cls_instance)
      :staticmethod:
      :abstractmethod:

      Create upgraded superclass instance.
      This constructs an approximate layer instance using the configuration
      of a vanilla torch layer implementation.


   .. py:method:: baseline_fwd(x: torch.Tensor) -> torch.Tensor
      :abstractmethod:

      Unperturbed FP32 forward pass

      :param x: Layer input

      :returns: Layer output


   .. py:method:: quant_fwd(x: torch.Tensor) -> torch.Tensor
      :abstractmethod:

      Quantized Forward Pass
      Performs the layer operation with an additional pass through the
      currently configured quantizer

      :param x: Layer input

      :returns: Layer output


   .. py:method:: approx_fwd(x: torch.Tensor) -> torch.Tensor
      :abstractmethod:

      Approximate Product Forward Pass
      Performs the layer operation using the currently configured
      approximate product Lookup Table.
      Quantization is implicitly applied to the input and weights.

      :param x: Layer input

      :returns: Layer output


   .. py:method:: noise_fwd(x: torch.Tensor) -> torch.Tensor

      Quantized Forward Pass that is perturbed
      with Gaussian Noise

      The standard deviation of the additive noise
      is derived from the `stdev`parameter and scaled
      with the standard deviation of the current batch

      :param x: Layer input

      :returns: Layer output


   .. py:method:: forward(x: torch.Tensor, bias: torch.Tensor) -> torch.Tensor

      Forward pass with currently selected mode applied

      :param x: Layer input

      :returns: Layer output



.. py:class:: InferenceMode

   Bases: :py:obj:`enum.Enum`

   Layer inference mode. Can be any of:
   - `base`: Run inference as unperturbed FP32 baseline
   - `quant`: Run inference using the layer's quantizer
   - `approx`: Run inference using approximate product LUT
   - `noise`: Run inference that is perturbed with additive Gaussian noise

   .. py:attribute:: BASELINE
      :annotation: = Baseline Mode

      

   .. py:attribute:: QUANTIZED
      :annotation: = Quantized Mode

      

   .. py:attribute:: NOISE
      :annotation: = Noise Mode

      

   .. py:attribute:: APPROXIMATE
      :annotation: = Approximate Mode

      


.. py:class:: ApproxLinear(*args, **kwargs)

   Bases: :py:obj:`torch.nn.Linear`, :py:obj:`torchapprox.layers.approx_layer.ApproxLayer`

   Approximate Linear Layer implementation

   .. py:property:: fan_in
      :type: int

      Number of incoming connections for a neuron in this layer

   .. py:property:: opcount
      :type: int

      Number of multiplications for a single
      forward pass of this layer

   .. py:method:: from_super(cls_instance: torch.nn.Linear)
      :staticmethod:

      Alias for from_linear


   .. py:method:: from_linear(linear: torch.nn.Linear)
      :staticmethod:

      Construct ApproxLinear from torch.nn.Linear layer


   .. py:method:: baseline_fwd(x)

      Unperturbed FP32 forward pass

      :param x: Layer input

      :returns: Layer output


   .. py:method:: quant_fwd(x)

      Quantized Forward Pass
      Performs the layer operation with an additional pass through the
      currently configured quantizer

      :param x: Layer input

      :returns: Layer output


   .. py:method:: approx_fwd(x)

      Approximate Product Forward Pass
      Performs the layer operation using the currently configured
      approximate product Lookup Table.
      Quantization is implicitly applied to the input and weights.

      :param x: Layer input

      :returns: Layer output


   .. py:method:: forward(x)

      Forward pass with currently selected mode applied

      :param x: Layer input

      :returns: Layer output



